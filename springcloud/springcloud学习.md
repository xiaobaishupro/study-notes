## springcloudå­¦ä¹ 

ä¼˜ç§€ç½‘ç«™ï¼šç†è®ºç†è§£ï¼šhttps://juejin.cn/post/6869264020205993997

https://www.cnblogs.com/xuwujing/p/10273989.html

#### ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„ï¼Ÿ

æ ¹æ®ä¸šåŠ¡æ‹†åˆ†è½¯ä»¶æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—å•ç‹¬è¿è¡Œï¼Œæ¯ä¸ªæ¨¡å—æœ¬èº«æ˜¯å•ä½“ã€‚

#### ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Ÿ

å¦‚æœè‹¥å¹²ä¸ªç¨‹åºå¦‚æœéƒ¨ç½²åœ¨è‹¥å¹²å°ä¸åŒçš„è®¡ç®—æœºä¸Šï¼Œå®ƒä»¬é€šè¿‡ç½‘ç»œç›¸äº’åä½œæœ€ç»ˆå®Œæˆä¸€ä¸ªæœåŠ¡ï¼Œé‚£ä¹ˆè¿™äº›ç¨‹åºç»„æˆçš„ç³»ç»Ÿå°±å¯ä»¥ç§°ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿã€‚

#### ä»€ä¹ˆæ˜¯é›†ç¾¤ï¼Ÿ

è®¡ç®—æœºé›†ç¾¤ç®€ç§°é›†ç¾¤æ˜¯ä¸€ç§è®¡ç®—æœºç³»ç»Ÿï¼Œå®ƒé€šè¿‡ä¸€ç»„æ¾æ•£é›†æˆçš„è®¡ç®—æœºè½¯ä»¶å’Œ/æˆ–ç¡¬ä»¶è¿æ¥èµ·æ¥é«˜åº¦ç´§å¯†åœ°åä½œå®Œæˆè®¡ç®—å·¥ä½œã€‚åœ¨æŸç§æ„ä¹‰ä¸Šï¼Œä»–ä»¬å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€å°è®¡ç®—æœºã€‚é›†ç¾¤ç³»ç»Ÿä¸­çš„å•ä¸ªè®¡ç®—æœºé€šå¸¸ç§°ä¸ºèŠ‚ç‚¹ï¼Œé€šå¸¸é€šè¿‡å±€åŸŸç½‘è¿æ¥ï¼Œä½†ä¹Ÿæœ‰å…¶å®ƒçš„å¯èƒ½è¿æ¥æ–¹å¼ã€‚é›†ç¾¤è®¡ç®—æœºé€šå¸¸ç”¨æ¥æ”¹è¿›å•ä¸ªè®¡ç®—æœºçš„è®¡ç®—é€Ÿåº¦å’Œ/æˆ–å¯é æ€§ã€‚ä¸€èˆ¬æƒ…å†µä¸‹é›†ç¾¤è®¡ç®—æœºæ¯”å•ä¸ªè®¡ç®—æœºï¼Œæ¯”å¦‚å·¥ä½œç«™æˆ–è¶…çº§è®¡ç®—æœºæ€§èƒ½ä»·æ ¼æ¯”è¦é«˜å¾—å¤š

é›†ç¾¤æŠ€æœ¯ç‰¹ç‚¹ï¼š

- é€šè¿‡**å¤šå°è®¡ç®—æœºå®ŒæˆåŒä¸€ä¸ªå·¥ä½œ**ï¼Œè¾¾åˆ°æ›´é«˜çš„æ•ˆç‡ã€‚

- **ä¸¤æœºæˆ–å¤šæœºå†…å®¹ã€å·¥ä½œè¿‡ç¨‹ç­‰å®Œå…¨ä¸€æ ·**ã€‚å¦‚æœä¸€å°æ­»æœºï¼Œå¦ä¸€å°å¯ä»¥èµ·ä½œç”¨ã€‚

  ç®€å•ç†è§£é›†ç¾¤ï¼šåŒä¸€ä¸ªä¸šåŠ¡ï¼Œéƒ¨ç½²åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Š(ä¸åŒçš„æœåŠ¡å™¨è¿è¡ŒåŒæ ·çš„ä»£ç ï¼Œå¹²åŒä¸€ä»¶äº‹)

#### åˆ†å¸ƒå¼å’Œé›†ç¾¤çš„åŒºåˆ«

åˆ†å¸ƒå¼æ˜¯ä»¥ç¼©çŸ­å•ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´æ¥æå‡æ•ˆç‡çš„ï¼Œè€Œé›†ç¾¤åˆ™æ˜¯é€šè¿‡æé«˜å•ä½æ—¶é—´å†…æ‰§è¡Œçš„ä»»åŠ¡æ•°æ¥æå‡æ•ˆç‡ã€‚

åˆ†å¸ƒå¼ï¼šä¸€ä¸ªä»»åŠ¡åˆ†æˆ3ä¸ªå­ä»»åŠ¡ï¼Œç”±3ä¸ªæœåŠ¡å™¨åˆ†åˆ«å®Œæˆ3ä¸ªå­ä»»åŠ¡ï¼›æ¯ä¸ªæœåŠ¡å™¨åªèƒ½å®ŒæˆæŸä¸ªç‰¹å®šçš„å­ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼šå®¢äººç‚¹èœï¼Œéœ€è¦ä¹°èœï¼Œç‚’èœï¼Œä¸Šèœä¸‰ä¸ªå­ä»»åŠ¡å®Œæˆï¼Œé‚£ä¹ˆç”±3ä¸ªäººåˆ†åˆ«å®Œæˆè¿™ä¸‰ä¸ªä»»åŠ¡ï¼Œä¸€ä¸ªäººä¹°èœï¼Œä¸€ä¸ªäººç‚’èœï¼Œä¸€ä¸ªäººä¸Šèœï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼ã€‚
é›†ç¾¤ï¼šä¸€ä¸ªä»»åŠ¡å¯ä»¥åˆ‡æˆ3ä¸ªä»»åŠ¡ï¼Œç”±3ä¸ªæœåŠ¡å…±åŒå®Œæˆè¿™3ä¸ªä»»åŠ¡ï¼›æ¯ä¸ªæœåŠ¡å™¨éƒ½èƒ½ç‹¬ç«‹å®Œæˆè¯¥ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼šå®¢äººç‚¹èœï¼Œåº—é‡Œæœ‰ä¸‰ä¸ªäººï¼Œä»–ä»¬æ¯ä¸ªäººéƒ½ä¼šä¹°èœç‚’èœå’Œä¸Šèœï¼Œä»–ä»¬å…±åŒå®Œæˆä»»åŠ¡ï¼Œä¸€ä¸ªäººç‚’é’èœï¼Œä¸€ä¸ªäººç‚–æ±¤ï¼Œä¸€ä¸ªäººå¤è‚‰ï¼Œè¿™å°±æ˜¯é›†ç¾¤

#### Spring Cloudä¸Spring Boot

springbootç”¨æ¥æ„å»ºå¾®æœåŠ¡ï¼Œå½“å¾®æœåŠ¡è¿‡å¤šï¼ŒSpring Cloudæ¥æ²»ç†æœåŠ¡ã€‚

éœ€è¦æ²»ç†çš„é—®é¢˜ï¼š

- æ€ä¹ˆè§£å†³æœåŠ¡ä¹‹é—´çš„ç›¸äº’è°ƒç”¨
- å‡å¦‚åœ¨æœåŠ¡ä¹‹é—´çš„ç›¸äº’è°ƒç”¨ä¸­ï¼ŒæŸä¸ªæœåŠ¡å› ä¸ºç½‘ç»œæˆ–å…¶ä»–åŸå› å¯¼è‡´å¾ˆä¹…æ²¡æœ‰è¿”å›ç»“æœï¼Œåº”è¯¥æ€ä¹ˆå¤„ç†
- å„ä¸ªæ¨¡å—çš„é…ç½®å¦‚ä½•ç»Ÿä¸€çš„ç®¡ç†
- å¦‚ä½•å±è”½æˆ‘çš„çœŸå®è®¿é—®è·¯å¾„ï¼Œå°±æ˜¯åœ¨æˆ‘çš„çœŸå®è®¿é—®è·¯å¾„åŒ…è£…ä¸€å±‚ï¼Œç±»ä¼¼äºè™šæ‹Ÿæ‰‹æœºå·

#### springcloudç®€ä»‹

Spring Cloudæ˜¯ä¸€ç³»åˆ—æ¡†æ¶çš„[æœ‰åºé›†åˆ](https://baike.baidu.com/item/æœ‰åºé›†åˆ/994839?fromModule=lemma_inlink)ã€‚å®ƒåˆ©ç”¨Spring Bootçš„å¼€å‘ä¾¿åˆ©æ€§å·§å¦™åœ°ç®€åŒ–äº†åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€è®¾æ–½çš„å¼€å‘ï¼Œå¦‚æœåŠ¡å‘ç°æ³¨å†Œã€é…ç½®ä¸­å¿ƒã€æ¶ˆæ¯æ€»çº¿ã€è´Ÿè½½å‡è¡¡ã€æ–­è·¯å™¨ã€æ•°æ®ç›‘æ§ç­‰ï¼Œéƒ½å¯ä»¥ç”¨Spring Bootçš„å¼€å‘é£æ ¼åšåˆ°ä¸€é”®å¯åŠ¨å’Œéƒ¨ç½²ã€‚Spring Cloudå¹¶æ²¡æœ‰é‡å¤åˆ¶é€ è½®å­ï¼Œå®ƒåªæ˜¯å°†å„å®¶å…¬å¸å¼€å‘çš„æ¯”è¾ƒæˆç†Ÿã€ç»å¾—èµ·å®é™…è€ƒéªŒçš„æœåŠ¡æ¡†æ¶ç»„åˆèµ·æ¥ï¼Œé€šè¿‡Spring Booté£æ ¼è¿›è¡Œå†å°è£…å±è”½æ‰äº†å¤æ‚çš„é…ç½®å’Œå®ç°åŸç†ï¼Œæœ€ç»ˆç»™å¼€å‘è€…ç•™å‡ºäº†ä¸€å¥—ç®€å•æ˜“æ‡‚ã€æ˜“éƒ¨ç½²å’Œæ˜“ç»´æŠ¤çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘å·¥å…·åŒ…ã€‚

ä¸€ç³»åˆ—æ²»ç†å¾®æœåŠ¡çš„æ¡†æ¶é›†åˆã€‚

#### springcloudç»„ä»¶ï¼ˆspring Cloud Netflixå®¶æ—ï¼‰

- Eureka æ³¨å†Œä¸­å¿ƒ ä¸»ç®¡æœåŠ¡çš„å‘ç°ä¸ç›¸äº’è°ƒç”¨
- Feign è¿œç¨‹è°ƒç”¨è€…
- Ribbon è´Ÿè½½å‡è¡¡å™¨
- zuul ç½‘å…³
- config é…ç½®ä¸­å¿ƒ
- Hystrix ç†”æ–­å™¨

##### æ³¨å†Œä¸­å¿ƒ Eureka

> Eurekaä¸“é—¨ç”¨äºç»™å…¶ä»–æœåŠ¡æ³¨å†Œçš„ç§°ä¸ºEureka Server(æœåŠ¡æ³¨å†Œä¸­å¿ƒ)ï¼Œå…¶ä½™æ³¨å†Œåˆ°Eureka Serverçš„æœåŠ¡ç§°ä¸ºEureka Clientã€‚

Eureka Serveræä¾›æœåŠ¡æ³¨å†ŒæœåŠ¡ï¼Œå„ä¸ªèŠ‚ç‚¹å¯åŠ¨åï¼Œä¼šåœ¨Eureka Serverä¸­è¿›è¡Œæ³¨å†Œï¼Œè¿™æ ·EurekaServerä¸­çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­å°†ä¼šå­˜å‚¨æ‰€æœ‰å¯ç”¨æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒæœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯å¯ä»¥åœ¨ç•Œé¢ä¸­ç›´è§‚çš„çœ‹åˆ°ã€‚

Eureka Clientæ˜¯ä¸€ä¸ª[java](https://baike.baidu.com/item/java/85979?fromModule=lemma_inlink)å®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ–ä¸Eureka Serverçš„äº¤äº’ï¼Œå®¢æˆ·ç«¯åŒæ—¶ä¹Ÿå°±æ˜¯ä¸€ä¸ªå†…ç½®çš„ã€ä½¿ç”¨è½®è¯¢(round-robin)è´Ÿè½½ç®—æ³•çš„[è´Ÿè½½å‡è¡¡å™¨](https://baike.baidu.com/item/è´Ÿè½½å‡è¡¡å™¨/8852239?fromModule=lemma_inlink)

åœ¨åº”ç”¨å¯åŠ¨åï¼Œå°†ä¼šå‘Eureka Serverå‘é€å¿ƒè·³,é»˜è®¤å‘¨æœŸä¸º30ç§’ï¼Œå¦‚æœEureka Serveråœ¨å¤šä¸ªå¿ƒè·³å‘¨æœŸå†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³ï¼ŒEureka Serverå°†ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­æŠŠè¿™ä¸ªæœåŠ¡èŠ‚ç‚¹ç§»é™¤(é»˜è®¤90ç§’)ã€‚

Eureka Serverä¹‹é—´é€šè¿‡å¤åˆ¶çš„æ–¹å¼å®Œæˆæ•°æ®çš„åŒæ­¥ï¼ŒEurekaè¿˜æä¾›äº†å®¢æˆ·ç«¯ç¼“å­˜æœºåˆ¶ï¼Œå³ä½¿æ‰€æœ‰çš„Eureka Serveréƒ½æŒ‚æ‰ï¼Œå®¢æˆ·ç«¯ä¾ç„¶å¯ä»¥åˆ©ç”¨ç¼“å­˜ä¸­çš„ä¿¡æ¯æ¶ˆè´¹å…¶ä»–æœåŠ¡çš„APIã€‚ç»¼ä¸Šï¼ŒEurekaé€šè¿‡å¿ƒè·³æ£€æŸ¥ã€[å®¢æˆ·ç«¯ç¼“å­˜](https://baike.baidu.com/item/å®¢æˆ·ç«¯ç¼“å­˜/10237000?fromModule=lemma_inlink)ç­‰æœºåˆ¶ï¼Œç¡®ä¿äº†ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€çµæ´»æ€§å’Œå¯ä¼¸ç¼©æ€§ã€‚

##### ä»€ä¹ˆæ˜¯ RestTemplate?

**`RestTemplate`æ˜¯`Spring`æä¾›çš„ä¸€ä¸ªè®¿é—®HttpæœåŠ¡çš„å®¢æˆ·ç«¯ç±»**ï¼Œæ€ä¹ˆè¯´å‘¢ï¼Ÿå°±æ˜¯å¾®æœåŠ¡ä¹‹é—´çš„è°ƒç”¨æ˜¯ä½¿ç”¨çš„ `RestTemplate` ã€‚æ¯”å¦‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ æ¶ˆè´¹è€…B éœ€è¦è°ƒç”¨ æä¾›è€…A æ‰€æä¾›çš„æœåŠ¡æˆ‘ä»¬å°±éœ€è¦è¿™ä¹ˆå†™ã€‚å¦‚æˆ‘ä¸‹é¢çš„ä¼ªä»£ç ã€‚

```java
@Autowired
private RestTemplate restTemplate;
// è¿™é‡Œæ˜¯æä¾›è€…Açš„ipåœ°å€ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨äº† Eureka é‚£ä¹ˆå°±åº”è¯¥æ˜¯æä¾›è€…Açš„åç§°
private static final String SERVICE_PROVIDER_A = "http://localhost:8081";

@PostMapping("/judge")
public boolean judge(@RequestBody Request request) {
    String url = SERVICE_PROVIDER_A + "/service1";
    return restTemplate.postForObject(url, request, Boolean.class);
}
```

##### è´Ÿè½½å‡è¡¡ä¹‹ Ribbon

**ä¸ºä»€ä¹ˆéœ€è¦ Ribbonï¼Ÿ**

`Ribbon` æ˜¯ `Netflix` å…¬å¸çš„ä¸€ä¸ªå¼€æºçš„è´Ÿè½½å‡è¡¡ é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯/è¿›ç¨‹å†…è´Ÿè½½å‡è¡¡å™¨ï¼Œ**è¿è¡Œåœ¨æ¶ˆè´¹è€…ç«¯**ã€‚

**nginx å’Œ Ribbon çš„å¯¹æ¯”**

æåˆ° **è´Ÿè½½å‡è¡¡** å°±ä¸å¾—ä¸æåˆ°å¤§åé¼é¼çš„ `Nignx` äº†ï¼Œè€Œå’Œ `Ribbon` ä¸åŒçš„æ˜¯ï¼Œå®ƒæ˜¯ä¸€ç§**é›†ä¸­å¼**çš„è´Ÿè½½å‡è¡¡å™¨ã€‚

ä½•ä¸ºé›†ä¸­å¼å‘¢ï¼Ÿç®€å•ç†è§£å°±æ˜¯ **å°†æ‰€æœ‰è¯·æ±‚éƒ½é›†ä¸­èµ·æ¥ï¼Œç„¶åå†è¿›è¡Œè´Ÿè½½å‡è¡¡**ã€‚

`Nginx` æ˜¯æ¥æ”¶äº†æ‰€æœ‰çš„è¯·æ±‚è¿›è¡Œè´Ÿè½½å‡è¡¡çš„ï¼Œè€Œå¯¹äº `Ribbon` æ¥è¯´å®ƒæ˜¯åœ¨æ¶ˆè´¹è€…ç«¯è¿›è¡Œçš„è´Ÿè½½å‡è¡¡ã€‚

åœ¨ `Nginx` ä¸­è¯·æ±‚æ˜¯å…ˆè¿›å…¥è´Ÿè½½å‡è¡¡å™¨ï¼Œè€Œåœ¨ `Ribbon` ä¸­æ˜¯å…ˆåœ¨å®¢æˆ·ç«¯è¿›è¡Œè´Ÿè½½å‡è¡¡æ‰è¿›è¡Œè¯·æ±‚çš„ã€‚

> 1ï¼Œnginx æ˜¯æœåŠ¡å™¨ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæ‰€æœ‰è¯·æ±‚å‘é€åˆ°nginxä¹‹åï¼Œnginxé€šè¿‡åå‘ä»£ç†çš„åŠŸèƒ½åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œåšè´Ÿè½½å‡è¡¡
>
> 2ï¼Œribbonæ˜¯å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œä»–æ˜¯é€šè¿‡å°†eurekaæ³¨å†Œä¸­å¿ƒä¸Šçš„æœåŠ¡ï¼Œè¯»å–ä¸‹æ¥ï¼Œç¼“å­˜åœ¨æœ¬åœ°ï¼Œæœ¬åœ°é€šè¿‡è½®è¯¢ç®—æ³•ï¼Œå®ç°å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡

##### ä»€ä¹ˆæ˜¯ Open Feign

äº† `Eureka`ï¼Œ`RestTemplate`ï¼Œ`Ribbon` æˆ‘ä»¬å°±å¯ä»¥ğŸ˜ƒæ„‰å¿«åœ°è¿›è¡ŒæœåŠ¡é—´çš„è°ƒç”¨äº†ï¼Œä½†æ˜¯ä½¿ç”¨ `RestTemplate` è¿˜æ˜¯ä¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½è¦è¿›è¡Œè¿™æ ·çš„è°ƒç”¨ã€‚

```java
@Autowired
private RestTemplate restTemplate;
// è¿™é‡Œæ˜¯æä¾›è€…Açš„ipåœ°å€ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨äº† Eureka é‚£ä¹ˆå°±åº”è¯¥æ˜¯æä¾›è€…Açš„åç§°
private static final String SERVICE_PROVIDER_A = "http://localhost:8081";

@PostMapping("/judge")
public boolean judge(@RequestBody Request request) {
    String url = SERVICE_PROVIDER_A + "/service1";
    // æ˜¯ä¸æ˜¯å¤ªéº»çƒ¦äº†ï¼Ÿï¼Ÿï¼Ÿæ¯æ¬¡éƒ½è¦ urlã€è¯·æ±‚ã€è¿”å›ç±»å‹çš„ 
    return restTemplate.postForObject(url, request, Boolean.class);
}
```

æ ·æ¯æ¬¡éƒ½è°ƒç”¨ `RestRemplate` çš„ `API` æ˜¯å¦å¤ªéº»çƒ¦ï¼Œæˆ‘èƒ½ä¸èƒ½åƒ**è°ƒç”¨åŸæ¥ä»£ç ä¸€æ ·è¿›è¡Œå„ä¸ªæœåŠ¡é—´çš„è°ƒç”¨å‘¢ï¼Ÿ**

ğŸ’¡ğŸ’¡ğŸ’¡èªæ˜çš„å°æœ‹å‹è‚¯å®šæƒ³åˆ°äº†ï¼Œé‚£å°±ç”¨ **æ˜ å°„** å‘€ï¼Œå°±åƒåŸŸåå’ŒIPåœ°å€çš„æ˜ å°„ã€‚æˆ‘ä»¬å¯ä»¥å°†è¢«è°ƒç”¨çš„æœåŠ¡ä»£ç æ˜ å°„åˆ°æ¶ˆè´¹è€…ç«¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ **â€œæ— ç¼å¼€å‘â€**å•¦ã€‚

OpenFeign ä¹Ÿæ˜¯è¿è¡Œåœ¨æ¶ˆè´¹è€…ç«¯çš„ï¼Œä½¿ç”¨ Ribbon è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œæ‰€ä»¥ OpenFeign ç›´æ¥å†…ç½®äº† Ribbonã€‚

åœ¨å¯¼å…¥äº† `Open Feign` ä¹‹åæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œæ„‰å¿«ç¼–å†™ `Consumer` ç«¯ä»£ç äº†ã€‚

```java
// ä½¿ç”¨ @FeignClient æ³¨è§£æ¥æŒ‡å®šæä¾›è€…çš„åå­—
@FeignClient(value = "eureka-client-provider")
public interface TestClient {
    // è¿™é‡Œä¸€å®šè¦æ³¨æ„éœ€è¦ä½¿ç”¨çš„æ˜¯æä¾›è€…é‚£ç«¯çš„è¯·æ±‚ç›¸å¯¹è·¯å¾„ï¼Œè¿™é‡Œå°±ç›¸å½“äºæ˜ å°„äº†
    @RequestMapping(value = "/provider/xxx",
    method = RequestMethod.POST)
    CommonResponse<List<Plan>> getPlans(@RequestBody planGetRequest request);
}
```

